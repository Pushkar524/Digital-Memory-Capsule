{% extends "layout.html" %}
{% block content %}
  <section class="card">
    <div class="row">
      <div>
        <h2>Capsule #{{ capsule.id }}</h2>
        <p class="muted">Unlocked at: {{ capsule.unlock_time }}</p>
      </div>
      <a class="link" href="{{ url_for('index') }}">Back</a>
    </div>
    <form class="form" method="post" action="{{ url_for('unlock', capsule_id=capsule.id) }}">
      <label>
        Recipient email
        <input type="email" name="user_email" placeholder="recipient@example.com" required />
      </label>
      <label>
        Your key half (base64)
        <input type="text" name="user_key_half" placeholder="Paste your key half" required />
      </label>
      <button type="submit">Unlock</button>
    </form>
    {% if unlock_status == "locked" %}
      <p class="muted">This capsule is locked. Enter your key half to decrypt.</p>
    {% elif unlock_status == "invalid" %}
      <p class="muted">Incorrect key half. Please try again.</p>
    {% elif unlock_status == "missing" %}
      <p class="muted">Please provide your key half to continue.</p>
    {% elif unlock_status == "success" %}
      <p class="muted">Decryption successful.</p>
    {% endif %}
    {% if capsule.message %}
      <p class="message-box">{{ capsule.message }}</p>
    {% endif %}
  </section>

  {% if capsule.files %}
    <section class="card">
      <h3>Files</h3>
      <ul class="list">
        {% for file in capsule.files %}
          <li class="row">
            <div>
              <span class="mono">{{ file.filename }}</span>
              <span class="muted"> ({{ file.size }} bytes)</span>
            </div>
            <a class="link" href="{{ url_for('download_file', file_id=file.id) }}">Download</a>
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}
{% endblock %}
