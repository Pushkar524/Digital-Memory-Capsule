{% extends "layout.html" %}
{% block content %}
  <section class="card hero">
    <div>
      <h2>Exhibition Prototype</h2>
      <p class="subtitle">Capture memories today, unlock them in the future.</p>
    </div>
    <div class="hero-badge">AES â€¢ Fernet</div>
  </section>

  <section class="card">
    <h2>Create a capsule</h2>
    <form class="form" method="post" action="{{ url_for('index') }}" enctype="multipart/form-data">
      <label>
        Sender email
        <input type="email" name="sender_email" placeholder="sender@example.com" required />
      </label>
      <label>
        Recipient email
        <input type="email" name="recipient_email" placeholder="recipient@example.com" required />
      </label>
      <label>
        Message
        <textarea name="message" rows="4" placeholder="Write your message" required></textarea>
      </label>
      <label>
        Unlock time
        <input type="datetime-local" name="unlock_time">
      </label>
      <label>
        Attach files (max 30MB each)
        <input
          type="file"
          name="files"
          multiple
          accept=".pdf,.docx,.xls,.xlsx,.png,.jpg,.jpeg,.gif,.webp,.mp4"
        />
      </label>
      <button type="submit">Save capsule</button>
    </form>
  </section>

  <section class="card">
    <h2>How encryption works</h2>
    <p class="muted">
      Your message and files are encrypted on save using Fernet (AES + HMAC). The
      encryption key stays on this device in <span class="mono">fernet.key</span>,
      so only this app can unlock the contents.
    </p>
  </section>

  {% if encrypted_preview %}
    <section class="card">
      <h2>Encrypted hash</h2>
      <div class="preview">{{ encrypted_preview }}</div>
    </section>
  {% endif %}

  {% if user_key_half %}
    <section class="card">
      <h2>Your key half (save this)</h2>
      <div class="preview">{{ user_key_half }}</div>
      <p class="muted">Keep this safe. You will need it to unlock the capsule.</p>
    </section>
  {% endif %}

  <section class="card">
    <h2>Saved capsules</h2>
    {% if capsules %}
      <ul class="list">
        {% for capsule in capsules %}
          <li>
            <div class="row">
              <div>
                <h3>Capsule #{{ capsule.id }}</h3>
                <p class="muted">Unlocks at: {{ capsule.unlock_time }}</p>
              </div>
              <a class="link" href="{{ url_for('unlock', capsule_id=capsule.id) }}">Unlock</a>
            </div>
            <p class="muted">Encrypted hash:</p>
            <div class="preview">{{ capsule.encrypted_preview }}</div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">No capsules yet. Create your first one above.</p>
    {% endif %}
  </section>

  <section class="card">
    <h2>Manage capsules</h2>
    <form method="post" action="{{ url_for('clear_capsules') }}" onsubmit="return confirm('Clear all capsules and files?');">
      <button type="submit" class="danger">Clear all capsules</button>
    </form>
  </section>
{% endblock %}
